!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports,require("js-base64")):"function"==typeof define&&define.amd?define(["exports","js-base64"],s):s((t=t||self).TTS={},t.jsBase64)}(this,function(d,E){"use strict";var t,s,c=function(){return(c=Object.assign||function(t){for(var s,e=1,r=arguments.length;e<r;e++)for(var i in s=arguments[e])Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i]);return t}).apply(this,arguments)};function p(t,s){return{AISdkError:!0,type:t,error:s}}(t=d.TTSStatus||(d.TTSStatus={})).idle="idle",t.sessionBegin="ssb",t.textWrite="txtw",t.getResult="grs",t.sessionEnd="sse",(s=d.Error||(d.Error={})).RESPONSE_ERROR="RESPONSE_ERROR",s.NO_RESPONSE="NO_RESPONSE";var S=Promise.resolve(),e=(r.prototype.start=function(e){var r=this;if(this.status===d.TTSStatus.idle){this.status=d.TTSStatus.sessionBegin;var i={svc:"tts",syncid:"0".toString()},t=c(c({},e.ttsOption),{cmd:this.status,svc:i.svc,syncid:i.syncid});return this.end=this._end.bind(this,e,i),this.interact(t,e,i).catch(function(t){var s=p(d.Error.NO_RESPONSE,t);if(r.onErrorAdaptor(s),r.status!==d.TTSStatus.sessionEnd&&r.status!==d.TTSStatus.idle)return r._end(e,i);throw s})}},r.prototype._end=function(t,s){var e=this;if(this.status===d.TTSStatus.sessionEnd||this.status===d.TTSStatus.idle)return S;this.status=d.TTSStatus.sessionEnd;var r=t.ttsOption,i=r.appid,n=r.extend_params,a={auth_id:t.ttsOption.auth_id,appid:i,extend_params:n,cmd:this.status,sid:s.sid,syncid:s.syncid,svc:s.svc};return this.interact(a,t,s).catch(function(t){throw e.status,d.TTSStatus.idle,t})},r.prototype.onErrorAdaptor=function(t){this.onError&&this.onError(t)},r.prototype.processResponse=function(t,s,e){var r=t.result;if(!r){var i=p(d.Error.NO_RESPONSE,t);return this.onErrorAdaptor(i),Promise.reject(i)}if(0!==r.ret)return i=p(d.Error.RESPONSE_ERROR,t),this.onErrorAdaptor(i),Promise.reject(i);var n=s.ttsOption,a={appid:n.appid,extend_params:n.extend_params,sid:e.sid||"",syncid:e.syncid,svc:e.svc};if(this.status===d.TTSStatus.sessionBegin){e.sid=r.sid,this.status=d.TTSStatus.textWrite;var o=c(c({},a),{cmd:this.status,data:E.Base64.encode(s.text)});return this.interact(o,s,e)}if(this.status===d.TTSStatus.textWrite)return this.status=d.TTSStatus.getResult,o=c(c({},a),{cmd:this.status}),this.interact(o,s,e);if(this.status!==d.TTSStatus.getResult)return this.status===d.TTSStatus.sessionEnd&&(this.status=d.TTSStatus.idle),S;var u=r;return u.data&&this.processPCMBase64Data(u.data),0===u.ttsStatus?this._end(s,e):(o=c(c({},a),{cmd:this.status}),this.interact(o,s,e))},r.prototype.interact=function(t,s,e){var r=this;e.syncid=(+e.syncid+1).toString();var i,n,a,o,u,d,c,p,S,h,f={id:1,jsonrpc:"2.0",method:"deal_request",params:t};return(i={url:s.url,method:s.apiMethod,param:JSON.stringify(f)},a=(n=void 0===i?{}:i).url,o=void 0===a?"":a,u=n.method,d=void 0===u?"post":u,c=n.param,p=void 0===c?"":c,S=n.timeout,h=void 0===S?5e3:S,new Promise(function(e,r){d=d.toUpperCase();var i=new XMLHttpRequest;i.open(d,o,!0),i.timeout=h,i.setRequestHeader("Content-Type","application/json-rpc"),i.send(p),i.addEventListener("readystatechange",function(){if(i.readyState===i.DONE){var t=i.status;if(200<=t&&t<300||304===t)try{var s=JSON.parse(E.Base64.atob(i.responseText));e(s)}catch(t){r(t)}else r(i)}})})).then(function(t){return r.processResponse(t,s,e)})},r);function r(t,s){this.processPCMBase64Data=t,this.onError=s,this.status=d.TTSStatus.idle}d.default=e,d.genError=p,d.isAISdkError=function(t){return!0===t.AISdkError},Object.defineProperty(d,"__esModule",{value:!0})});
//# sourceMappingURL=TTS.umd.min.js.map
