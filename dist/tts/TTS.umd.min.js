!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s(require("js-base64")):"function"==typeof define&&define.amd?define(["js-base64"],s):(t=t||self).TTS=s(t.jsBase64)}(this,function(r){"use strict";var n="idle",o="ssb",u="txtw",d="grs",h="sse",e={id:1,jsonrpc:"2.0",method:"deal_request",params:{svc:"tts"}};function i(t){return JSON.parse(JSON.stringify(t))}function s(t){return t}function t(){this.syncid=0,this.status=null,this.extendParams=null,this.text=null,this.serverParams=null,this.sessionId=null}return t.prototype.initTts=function(t,s,e){void 0===t&&(t=""),void 0===e&&(e=""),this.text=e,this.serverParams=s,this.extendParams=s.extend_params,this.url=t,this.start()},t.prototype.start=function(){this.syncid=0,this.status=o;var t=i(e);t.params=Object.assign({},t.params,this.serverParams),t.params.cmd=this.status,t.params.syncid=this.syncid.toString(),this.syncid++,this.getData(t)},t.prototype.transApiData=function(t){void 0===t&&(t={});var s=i(e);return t.sid=this.sessionId,t.appid=this.appid,t.cmd=this.status,t.syncid=this.syncid.toString(),t.extend_params=this.extendParams,s.params=Object.assign({},s.params,t),s},t.prototype.detailData=function(t){void 0===t&&(t=s),this.detailData=t},t.prototype.end=function(){if(this.status&&this.status!==h&&this.status!==n){var t={auth_id:this.serverParams.auth_id};this.status=h;var s=this.transApiData(t);this.getData(s)}},t.prototype.onError=function(t){void 0===t&&(t=""),console.log(t)},t.prototype.processResponse=function(t){if(t){this.syncid++,console.log("x",r.Base64);var s=JSON.parse(r.Base64.atob(t));if(s.result&&0===s.result.ret)if(this.status!==o)if(this.status!==u)this.status!==d?this.status===h&&(this.status=n):(s.result.data&&this.detailData(s.result.data),0!==s.result.ttsStatus?(e=this.transApiData(),this.getData(e)):this.end());else{this.status=d;var e=this.transApiData();this.getData(e)}else{this.sessionId=s.result.sid,this.status=u;var i={data:r.Base64.encode(this.text)},a=this.transApiData(i);this.getData(a)}else this.onError("数据有误")}else this.onError()},t.prototype.getData=function(t,s){var e=this;void 0===t&&(t={}),void 0===s&&(s="post"),function(t,s,e,i){void 0===t&&(t="POST"),t=t.toUpperCase();var a=new XMLHttpRequest;a.open(t,s,!0),a.timeout=5e3,a.setRequestHeader("Content-Type","application/json-rpc"),a.send(e),a.onreadystatechange=function(){var t=null;try{t=a.responseText}catch(t){}if(4===a.readyState)if(200<=a.status&&a.status<300)i(null,t);else{if(500===a.status)return void i(new Error("系统异常"),t);if(504===a.status)return void i(new Error("网络超时"),t);i(new Error("请求失败"),t)}}}(s,this.url,JSON.stringify(t),function(t,s){t?e.onError(t):e.processResponse(s)})},t});
//# sourceMappingURL=TTS.umd.min.js.map
