!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).TTS=e()}(this,function(){"use strict";var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var base64=createCommonjsModule(function(module,exports){var e,f;e="undefined"!=typeof self?self:"undefined"!=typeof window?window:commonjsGlobal,f=function(global){global=global||{};var _Base64=global.Base64,version="2.5.1",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(t){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(t){for(var e={},r=0,o=t.length;r<o;r++)e[t.charAt(r)]=r;return e}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?fromCharCode(192|e>>>6)+fromCharCode(128|63&e):fromCharCode(224|e>>>12&15)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return fromCharCode(240|e>>>18&7)+fromCharCode(128|e>>>12&63)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(t){return t.replace(re_utob,cb_utob)},cb_encode=function(t){var e=[0,2,1][t.length%3],r=t.charCodeAt(0)<<16|(1<t.length?t.charCodeAt(1):0)<<8|(2<t.length?t.charCodeAt(2):0);return[b64chars.charAt(r>>>18),b64chars.charAt(r>>>12&63),2<=e?"=":b64chars.charAt(r>>>6&63),1<=e?"=":b64chars.charAt(63&r)].join("")},btoa=global.btoa?function(t){return global.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t)).toString("base64")}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t)).toString("base64")}:function(t){return btoa(utob(t))},encode=function(t,e){return e?_encode(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):_encode(String(t))},encodeURI=function(t){return encode(t,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return fromCharCode(55296+(e>>>10))+fromCharCode(56320+(1023&e));case 3:return fromCharCode((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return fromCharCode((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},btou=function(t){return t.replace(re_btou,cb_btou)},cb_decode=function(t){var e=t.length,r=e%4,o=(0<e?b64tab[t.charAt(0)]<<18:0)|(1<e?b64tab[t.charAt(1)]<<12:0)|(2<e?b64tab[t.charAt(2)]<<6:0)|(3<e?b64tab[t.charAt(3)]:0),n=[fromCharCode(o>>>16),fromCharCode(o>>>8&255),fromCharCode(255&o)];return n.length-=[0,0,2,1][r],n.join("")},_atob=global.atob?function(t){return global.atob(t)}:function(t){return t.replace(/\S{1,4}/g,cb_decode)},atob=function(t){return _atob(String(t).replace(/[^A-Za-z0-9\+\/]/g,""))},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t,"base64")).toString()}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t,"base64")).toString()}:function(t){return btou(_atob(t))},decode=function(t){return _decode(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var t=global.Base64;return global.Base64=_Base64,t};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty){var noEnum=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(t){return encode(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}return global.Meteor&&(Base64=global.Base64),module.exports&&(module.exports.Base64=global.Base64),{Base64:global.Base64}},module.exports=f(e)}),base64_1=base64.Base64,TTSStatus,ba;function http(t,n,a){return void 0===n&&(n="POST"),new Promise(function(e,r){n=n.toUpperCase();var o=new XMLHttpRequest;o.open(n,t,!0),o.timeout=5e3,o.setRequestHeader("Content-Type","application/json-rpc"),o.send(a),o.onreadystatechange=function(){if(4===o.readyState){if(200<=o.status&&o.status<300){var t=null;try{t=JSON.parse(base64_1.atob(o.responseText))}catch(t){return void r(t)}return void e(t)}if(500===o.status)return void r(new Error("系统异常"));if(504===o.status)return void r(new Error("网络超时"));r(new Error("请求失败"))}}})}function genRPCMessage(t){return{id:1,jsonrpc:"2.0",method:"deal_request",params:t}}ba=TTSStatus=TTSStatus||{},ba.idle="idle",ba.sessionBegin="ssb",ba.textWrite="txtw",ba.getResult="grs",ba.sessionEnd="sse";var TTS=(da.prototype.start=function(t){if(this.status===TTSStatus.idle){this.status=TTSStatus.sessionBegin;var e=t.ttsOption;e.cmd=this.status;var r={svc:"tts",syncid:(-1).toString()};e.svc=r.svc,this.getData(e,t,r)}},da.prototype.end=function(t,e){var r=this;if(this.status!==TTSStatus.sessionEnd&&this.status!==TTSStatus.idle){this.status=TTSStatus.sessionEnd;var o=t.ttsOption,n=o.appid,a=o.extend_params,s={auth_id:t.ttsOption.auth_id,appid:n,extend_params:a,cmd:this.status,sid:e.sid,syncid:e.syncid,svc:e.svc};this.getData(s,t,e).catch(function(){r.status,TTSStatus.idle})}},da.prototype.onError=function(t){void 0===t&&(t=""),console.log(t)},da.prototype.processResponse=function(t,e,r){if(t)if(0===t.ret)if(this.status!==TTSStatus.sessionBegin)if(this.status!==TTSStatus.textWrite){if(this.status===TTSStatus.getResult){var o=t;if(o.data&&this.processPCMBase64Data(o.data),0===o.ttsStatus)return void this.end(e,r);var n=e.ttsOption;s={appid:n.appid,extend_params:n.extend_params,cmd:this.status,sid:r.sid,syncid:r.syncid,svc:r.svc},this.getData(s,e,r)}this.status===TTSStatus.sessionEnd&&(this.status=TTSStatus.idle)}else{this.status=TTSStatus.getResult;var a=e.ttsOption,s={appid:a.appid,extend_params:a.extend_params,cmd:this.status,sid:r.sid,syncid:r.syncid,svc:r.svc};this.getData(s,e,r)}else{r.sid=t.sid,this.status=TTSStatus.textWrite;var i=e.ttsOption,s={appid:i.appid,extend_params:i.extend_params,cmd:this.status,sid:r.sid,syncid:r.syncid,svc:r.svc,data:base64_1.encode(e.text)};this.getData(s,e,r)}else this.onError("数据有误");else this.onError()},da.prototype.getData=function(t,e,r){var o=this;r.syncid=(+r.syncid+1).toString();var n=genRPCMessage(t);return http(e.url,e.apiMethod,JSON.stringify(n)).then(function(t){return o.processResponse(t.result,e,r),console.log(t.result),t.result}).catch(function(t){throw o.onError(t),t})},da);function da(t){this.status=TTSStatus.idle,this.processPCMBase64Data=t}return TTS});
//# sourceMappingURL=TTS.umd.min.js.map
