!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).TTS=e()}(this,function(){"use strict";function api(t,e,r,o){void 0===t&&(t="POST"),t=t.toUpperCase();var n=new XMLHttpRequest;n.open(t,e,!0),n.timeout=5e3,n.setRequestHeader("Content-Type","application/json-rpc"),n.send(r),n.onreadystatechange=function(){var t=null;try{t=n.responseText}catch(t){}if(4===n.readyState)if(200<=n.status&&n.status<300)o(null,t);else{if(500===n.status)return void o(new Error("系统异常"),t);if(504===n.status)return void o(new Error("网络超时"),t);o(new Error("请求失败"),t)}}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var base64=createCommonjsModule(function(module,exports){var l,m;l="undefined"!=typeof self?self:"undefined"!=typeof window?window:commonjsGlobal,m=function(global){global=global||{};var _Base64=global.Base64,version="2.5.1",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(t){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(t){for(var e={},r=0,o=t.length;r<o;r++)e[t.charAt(r)]=r;return e}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(t){if(t.length<2)return(e=t.charCodeAt(0))<128?t:e<2048?fromCharCode(192|e>>>6)+fromCharCode(128|63&e):fromCharCode(224|e>>>12&15)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e);var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return fromCharCode(240|e>>>18&7)+fromCharCode(128|e>>>12&63)+fromCharCode(128|e>>>6&63)+fromCharCode(128|63&e)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(t){return t.replace(re_utob,cb_utob)},cb_encode=function(t){var e=[0,2,1][t.length%3],r=t.charCodeAt(0)<<16|(1<t.length?t.charCodeAt(1):0)<<8|(2<t.length?t.charCodeAt(2):0);return[b64chars.charAt(r>>>18),b64chars.charAt(r>>>12&63),2<=e?"=":b64chars.charAt(r>>>6&63),1<=e?"=":b64chars.charAt(63&r)].join("")},btoa=global.btoa?function(t){return global.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t)).toString("base64")}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t)).toString("base64")}:function(t){return btoa(utob(t))},encode=function(t,e){return e?_encode(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):_encode(String(t))},encodeURI=function(t){return encode(t,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return fromCharCode(55296+(e>>>10))+fromCharCode(56320+(1023&e));case 3:return fromCharCode((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return fromCharCode((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},btou=function(t){return t.replace(re_btou,cb_btou)},cb_decode=function(t){var e=t.length,r=e%4,o=(0<e?b64tab[t.charAt(0)]<<18:0)|(1<e?b64tab[t.charAt(1)]<<12:0)|(2<e?b64tab[t.charAt(2)]<<6:0)|(3<e?b64tab[t.charAt(3)]:0),n=[fromCharCode(o>>>16),fromCharCode(o>>>8&255),fromCharCode(255&o)];return n.length-=[0,0,2,1][r],n.join("")},_atob=global.atob?function(t){return global.atob(t)}:function(t){return t.replace(/\S{1,4}/g,cb_decode)},atob=function(t){return _atob(String(t).replace(/[^A-Za-z0-9\+\/]/g,""))},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(t){return(t.constructor===buffer.constructor?t:buffer.from(t,"base64")).toString()}:function(t){return(t.constructor===buffer.constructor?t:new buffer(t,"base64")).toString()}:function(t){return btou(_atob(t))},decode=function(t){return _decode(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var t=global.Base64;return global.Base64=_Base64,t};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty){var noEnum=function(t){return{value:t,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(t){return encode(this,t)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}return global.Meteor&&(Base64=global.Base64),module.exports&&(module.exports.Base64=global.Base64),{Base64:global.Base64}},module.exports=m(l)}),base64_1=base64.Base64,ttsStatus={idle:"idle",sessionBegin:"ssb",textWrite:"txtw",getResult:"grs",sessionEnd:"sse"},commonParam={id:1,jsonrpc:"2.0",method:"deal_request",params:{svc:"tts"}};function cloneDeep(t){return JSON.parse(JSON.stringify(t))}function id(t){return t}var Tts=(ca.prototype.initTts=function(t,e,r){void 0===t&&(t=""),void 0===r&&(r=""),this.text=r,this.serverParams=e,this.extendParams=e.extend_params,this.url=t,this.start()},ca.prototype.start=function(){this.syncid=0,this.status=ttsStatus.sessionBegin;var t=cloneDeep(commonParam);t.params=Object.assign({},t.params,this.serverParams),t.params.cmd=this.status,t.params.syncid=this.syncid.toString(),this.syncid++,this.getData(t)},ca.prototype.transApiData=function(t){void 0===t&&(t={});var e=cloneDeep(commonParam);return t.sid=this.sessionId,t.appid=this.appid,t.cmd=this.status,t.syncid=this.syncid.toString(),t.extend_params=this.extendParams,e.params=Object.assign({},e.params,t),e},ca.prototype.detailData=function(t){void 0===t&&(t=id),this.detailData=t},ca.prototype.end=function(){if(this.status&&this.status!==ttsStatus.sessionEnd&&this.status!==ttsStatus.idle){var t={auth_id:this.serverParams.auth_id};this.status=ttsStatus.sessionEnd;var e=this.transApiData(t);this.getData(e)}},ca.prototype.onError=function(t){void 0===t&&(t=""),console.log(t)},ca.prototype.processResponse=function(t){if(t){this.syncid++,console.log("x",base64_1);var e=JSON.parse(base64_1.atob(t));if(e.result&&0===e.result.ret)if(this.status!==ttsStatus.sessionBegin)if(this.status!==ttsStatus.textWrite)this.status!==ttsStatus.getResult?this.status===ttsStatus.sessionEnd&&(this.status=ttsStatus.idle):(e.result.data&&this.detailData(e.result.data),0!==e.result.ttsStatus?(r=this.transApiData(),this.getData(r)):this.end());else{this.status=ttsStatus.getResult;var r=this.transApiData();this.getData(r)}else{this.sessionId=e.result.sid,this.status=ttsStatus.textWrite;var o={data:base64_1.encode(this.text)},n=this.transApiData(o);this.getData(n)}else this.onError("数据有误")}else this.onError()},ca.prototype.getData=function(t,e){var r=this;void 0===t&&(t={}),void 0===e&&(e="post"),api(e,this.url,JSON.stringify(t),function(t,e){t?r.onError(t):r.processResponse(e)})},ca);function ca(){this.syncid=0,this.status=null,this.extendParams=null,this.text=null,this.serverParams=null,this.sessionId=null}return Tts});
//# sourceMappingURL=TTS.umd.min.js.map
